## 项目说明：从视频自动提取 PPT 页面

这个小工具可以**自动从录屏视频中提取静止画面，并生成对应的 PPT 文件**。  
它适合用于：线上课录屏、会议录屏、讲解视频等需要从视频中抽取 PPT 页面的场景。

脚本文件：`tiqu.py`

### 功能特点

- **自动识别静止画面**：通过帧间变化检测，当画面保持静止一段时间后才截取，尽量避免截到动画中间过程。
- **去重与渐进动画处理**：
  - 使用 dHash + 汉明距离对图片去重，避免重复页。
  - 对渐进动画（内容逐步出现）做二次处理，尽量保留内容最完整的一张。
- **ROI 区域过滤**：可以选择忽略底部或右侧区域（如任务栏、摄像头画面）。
- **多线程批处理**：自动扫描当前目录下所有视频文件，使用多线程并行处理。
- **自动生成 PPT**：每个视频对应生成一个同名的 `.pptx` 文件，保存在 `output_ppts` 目录中。

---

## 环境要求

- **Python**：建议 Python 3.8 及以上版本
- **操作系统**：Windows / macOS / Linux（只要 OpenCV 能正常使用即可）

依赖库通过 `pip` 安装，详情见下文。

---

## 安装依赖

在项目根目录（`tiqu.py` 所在的目录）执行：

```bash
pip install -r requirements.txt
```

`requirements.txt` 中包含本项目需要的第三方库：

- `opencv-python`：读取视频、保存图片
- `numpy`：数值计算
- `python-pptx`：生成 PPT 文件

---

## 使用方法

1. **将脚本和视频放在同一个文件夹**
   - 把 `tiqu.py` 放在一个目录下。
   - 将要处理的所有视频（如 `.mp4`, `.avi` 等）放到同一目录中。

2. **安装依赖**

   参见上面的「安装依赖」部分：

   ```bash
   pip install -r requirements.txt
   ```

3. **运行脚本**

   在该目录下打开命令行（PowerShell / CMD / Terminal），执行：

   ```bash
   python tiqu.py
   ```

4. **查看输出结果**

   - 脚本会在当前目录下自动创建 `output_ppts` 文件夹（如果不存在）。
   - 每个视频对应生成一个同名的 `.pptx` 文件，例如：
     - `course1.mp4` → `output_ppts/course1.pptx`
   - 终端中会打印每个视频的处理进度和最终统计信息。

---

## 参数与逻辑简要说明

核心处理函数：`extract_slides_no_dedup(video_path, output_ppt_path, ...)`

主要参数（在 `tiqu.py` 里已经写好默认值，可按需修改）：

- **motion_threshold**：画面变化判定为“在动”的阈值（百分比）
  - 数值越小越敏感，轻微变化也会被认为在动。
  - 默认示例中使用 `0.2`（在 `process_video` 包装函数里）。
- **min_duration**：画面需要保持静止多久才保存（单位：秒）
  - 建议设置在 `1.5 ~ 2.0` 之间。
  - 时间越长，越不容易截到动画中间帧，但可能漏掉快速翻页。
- **hash_threshold**：哈希去重阈值
  - 汉明距离小于该值时认为两张图片几乎相同，会跳过保存重复帧。
- **use_morphology**：是否使用形态学操作消除鼠标等小物体干扰
  - 一般建议 `True`。
- **ignore_bottom_ratio / ignore_right_ratio**：
  - 忽略底部 / 右侧的一部分区域（比例 0.0 ~ 1.0）。
  - 例如：`ignore_bottom_ratio=0.1` 表示忽略底部 10% 的高度。

多线程处理部分：

- 脚本会遍历当前目录，找到所有后缀在
  `['.mp4', '.avi', '.mov', '.mkv', '.flv', '.wmv', '.m4v']`
  中的视频文件。
- 使用 `ThreadPoolExecutor` 按 CPU 核心数（不超过视频数）并行处理。

---

## 常见问题

- **Q：运行时报错 “无法打开视频”？**  
  **A**：确认视频文件没有损坏，路径中是否有特殊字符，或者尝试将视频放在简单路径（如桌面新建文件夹）下再试。

- **Q：没有生成任何 PPT？**  
  **A**：终端会提示「未找到任何视频文件」，请确认视频格式在支持列表中，且文件与 `tiqu.py` 在同一目录。

- **Q：生成的 PPT 页数太多 / 太少？**  
  **A**：可以适当调节 `motion_threshold` 和 `min_duration`：  
  - 页数太多 → 提高 `motion_threshold` 或增加 `min_duration`。  
  - 页数太少 → 降低 `motion_threshold` 或减小 `min_duration`。

---

## 许可证

本脚本未显式声明许可证，如需在商业项目中使用或二次分发，请根据实际情况自行补充许可证说明。


